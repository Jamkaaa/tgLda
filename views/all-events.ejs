<%- include('include/header') %>

<div class="container py-md-5">
  <%- include('include/flash') %>

  <div class="events-page-header">
    <h1 class="events-page-title">
  <i class="fas fa-calendar-alt"></i> Event
    </h1>
    <p class="events-page-subtitle">
      Have fun together! Find interesting events and join üéâ
    </p>
  </div>

  <% if (events && events.length) { %>
  <div class="events-grid">
    <% events.forEach(function(event) { %>
    <div class="event-card <%= event.isFull ? 'event-card--full' : '' %>">
      <div class="event-card-header">
        <span class="event-status-badge <%= event.isFull ? 'badge-danger' : 'badge-success' %>">
          <% if (event.isFull) { %>
            <i class="fas fa-lock"></i> –î“Ø“Ø—Ä—Å—ç–Ω
          <% } else { %>
            <i class="fas fa-check-circle"></i> –ù—ç—ç–ª—Ç—Ç—ç–π
          <% } %>
        </span>
        <span class="event-capacity-badge">
          <i class="fas fa-users"></i> <%= event.participants.length %>/<%= event.capacity %>
        </span>
      </div>

      <div class="event-card-body">
        <h3 class="event-card-title">
          <i class="fas fa-star event-title-icon"></i>
          <%= event.name %>
        </h3>

        <div class="event-info-item">
          <i class="fas fa-map-marker-alt"></i>
          <span><%= event.location %></span>
        </div>

        <div class="event-info-item">
          <i class="fas fa-clock"></i>
          <span><%= new Date(event.eventDate).toLocaleString('en-US', { 
            month: 'short', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit' 
          }) %></span>
        </div>

        <div class="event-info-item">
          <i class="fas fa-user-circle"></i>
          <span>–ó–æ—Ö–∏–æ–Ω –±–∞–π–≥—É—É–ª–∞–≥—á: <strong><%= event.author.username %></strong></span>
        </div>

        <p class="event-description">
          <%= event.description.substring(0, 100) %><%= event.description.length > 100 ? '...' : '' %>
        </p>

        <div class="event-progress">
          <div class="event-progress-bar" style="width: <%= (event.participants.length / event.capacity) * 100 %>%"></div>
        </div>
        <p class="event-progress-text">
          <strong><%= event.availableSpots %></strong> —Å—É—É–¥–∞–ª “Ø–ª–¥—Å—ç–Ω
        </p>
      </div>

      <div class="event-card-footer">
        <a href="/event/<%= event._id %>" class="btn btn-primary btn-sm event-view-btn">
          <i class="fas fa-eye"></i> –î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π
        </a>
        
        <% if (!event.isFull && !event.hasJoined && !event.isVisitorOwner) { %>
          <form action="/event/<%= event._id %>/join" method="POST" class="d-inline">
            <button class="btn btn-success btn-sm event-join-btn">
              <i class="fas fa-user-plus"></i> –ù—ç–≥–¥—ç—Ö
            </button>
          </form>
        <% } else if (event.hasJoined) { %>
          <span class="badge badge-info">
            <i class="fas fa-check"></i> –ù—ç–≥–¥—Å—ç–Ω
          </span>
        <% } else if (event.isFull) { %>
          <span class="badge badge-danger">
            <i class="fas fa-lock"></i> –î“Ø“Ø—Ä—Å—ç–Ω
          </span>
        <% } %>
      </div>
    </div>
    <% }) %>
  </div>
  <% } else { %>
  <div class="empty-events">
    <div class="empty-events-icon">
      <i class="fas fa-calendar-times"></i>
    </div>
    <h3>No events available</h3>
    <p class="text-muted">
      Create the first event and start inviting your friends!
    </p>
    <a href="/create-event" class="btn btn-success btn-lg">
      <i class="fas fa-plus-circle"></i> Create event
    </a>
  </div>
  <% } %>
</div>

<%- include('include/footer') %>
