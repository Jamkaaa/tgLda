<%- include('include/header') %>

<div class="container py-md-5 container--narrow">
  <%- include('include/flash') %> <%- include('include/profile-header') %>

  <% if (joinedEvents.length) { %>
  <div class="events-grid">
    <% joinedEvents.forEach(function(event) { %>
    <div class="event-card">
      <div class="event-card-header">
        <div class="event-status <%= event.isFull ? 'status-full' : 'status-open' %>">
          <% if (event.isFull) { %>
          <i class="fas fa-lock"></i> ДҮҮРСЭН
          <% } else { %>
          <i class="fas fa-door-open"></i> НЭЭЛТТЭЙ
          <% } %>
        </div>
      </div>
      <div class="event-card-body">
        <h3 class="event-card-title">
          <i class="fas fa-calendar-check"></i> <%= event.name %>
        </h3>
        <div class="event-card-info">
          <p class="event-location">
            <i class="fas fa-map-marker-alt"></i> <%= event.location %>
          </p>
          <p class="event-date">
            <i class="fas fa-clock"></i>
            <%= new Date(event.eventDate).toLocaleDateString('en-US', { 
              month: 'short', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            }) %>
          </p>
          <p class="event-capacity">
            <i class="fas fa-users"></i>
            <span class="capacity-number"><%= event.participants.length %>/<%= event.capacity %></span>
          </p>
        </div>
        <div class="event-card-progress">
          <div
            class="event-progress-bar"
            style="width: <%= (event.participants.length / event.capacity) * 100 %>%"
          ></div>
        </div>
        <div class="event-card-footer">
          <p class="event-author">
            <img
              class="avatar-tiny"
              src="<%= event.author.avatar %>"
              alt="<%= event.author.username %>"
            />
            Зохион байгуулагч: <strong><%= event.author.username %></strong>
          </p>
          <a href="/event/<%= event._id %>" class="btn btn-primary btn-sm event-view-btn">
            <i class="fas fa-eye"></i> Үзэх
          </a>
        </div>
      </div>
    </div>
    <% }) %>
  </div>
  <% } else { %>
  <div class="text-center py-5">
    <i class="fas fa-ticket-alt fa-4x text-muted mb-3"></i>
    <h3 class="text-muted">Одоогоор нэгдсэн үйл явдал байхгүй байна</h3>
    <p class="text-muted">
      <a href="/events" class="btn btn-primary mt-3">
        <i class="fas fa-search"></i> Үйл явдал хайх
      </a>
    </p>
  </div>
  <% } %>
</div>

<%- include('include/footer') %>
